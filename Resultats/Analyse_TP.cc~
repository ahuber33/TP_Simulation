#include "Analyse_TP.hh"

void Analyse_TP()
{


  float mp = 1.6726e-27; //kg
  float mHe = 4.0026*1.66054e-27;
  float Le1 = 0.15; //m
  float Le2 = 0.155; //m
  float Lb1 = 0.05; //m
  float Lb2 = 0.310; //m
  float E = 1.5e+6; //V/m
  float qp = 1.6e-19; //C
  float B = 0.3; //T


  float param_proton = Param_Parabole(mp, qp, Le1, Le2, E, Lb1, Lb2, B);
  TF1 *proton_calcul = new TF1("proton_calcul","[0]*x*x", -50, 0);
  proton_calcul->SetParameter(0, param_proton);

  float param_He1 = Param_Parabole(mHe, qp, Le1, Le2, E, Lb1, Lb2, B);
  TF1 *He1_calcul = new TF1("He1_calcul","[0]*x*x", -50, 0);
  He1_calcul->SetParameter(0, param_He1);

  float param_He2 = Param_Parabole(mHe, 2*qp, Le1, Le2, E, Lb1, Lb2, B);
  TF1 *He2_calcul = new TF1("He2_calcul","[0]*x*x", -50, 0);
  He2_calcul->SetParameter(0, param_He2);

  TGraph* g_proton_ligne = Graph_Parabole("proton_ligne.root", "TP");
  TGraph* g_He1_ligne = Graph_Parabole("He1+_ligne.root", "TP");
  TGraph* g_He2_ligne = Graph_Parabole("He2+_ligne.root", "TP");

  TAxis* xaxis = g_proton_ligne->GetXaxis();
  TAxis* yaxis = g_proton_ligne->GetYaxis();
  
  g_proton_ligne->Draw("AP");
  yaxis->SetLimits(0., 70.);
  g_proton_ligne->SetMarkerStyle(4);
  g_proton_ligne->SetMarkerSize(0.4);
  g_proton_ligne->SetMarkerColor(kRed);
  proton_calcul->Draw("same");
  proton_calcul->SetLineStyle(1);
  proton_calcul->SetLineColor(kOrange);
  
  g_He1_ligne->Draw("Psame");
  g_He1_ligne->SetMarkerStyle(4);
  g_He1_ligne->SetMarkerSize(0.4);
  g_He1_ligne->SetMarkerColor(kBlue);
  He1_calcul->Draw("same");
  He1_calcul->SetLineStyle(1);
  He1_calcul->SetLineColor(kCyan);

  g_He2_ligne->Draw("Psame");
  g_He2_ligne->SetMarkerStyle(4);
  g_He2_ligne->SetMarkerSize(0.4);
  g_He2_ligne->SetMarkerColor(kGreen+3);
  He2_calcul->Draw("same");
  He2_calcul->SetLineStyle(1);
  He2_calcul->SetLineColor(kGreen);

  auto legend = new TLegend(0.1,0.7,0.48,0.9);
  legend->AddEntry(g_proton_ligne,"Protons simulated parabola","p");
  legend->AddEntry(proton_calcul,"Protons calculated parabola","l");
  legend->AddEntry(g_He1_ligne,"He1+ simulated parabola","p");
  legend->AddEntry(He1_calcul,"He1+ calculated parabola","l");
  legend->AddEntry(g_He2_ligne,"He2+ simulated parabola","p");
  legend->AddEntry(He2_calcul,"He2+ calculated parabola","l");
  legend->Draw();
  
}
